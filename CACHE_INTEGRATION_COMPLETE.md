# ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞

## –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

### Backend (Python/FastAPI)

1. **`app/services/cache_manager.py`**
   - –°–æ–∑–¥–∞–Ω –º–µ–Ω–µ–¥–∂–µ—Ä –∫—ç—à–∞ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –∑–∞–≥—Ä—É–∑–∫–æ–π –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –≤—Å–µ—Ö –≥–æ—Ä–æ–¥–æ–≤
   - –§–æ–Ω–æ–≤–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 20 –º–∏–Ω—É—Ç
   - –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

2. **`app.py`**
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫—ç—à–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
   - –§–æ–Ω–æ–≤–∞—è –∑–∞–¥–∞—á–∞ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
   - –ù–æ–≤—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã: `/cities` –∏ `/cache/stats`

3. **`app/api/dashboard_sections.py`**
   - –í—Å–µ 4 dashboard —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω—ã –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ `city_id`
   - Fallback –∫ –ø—Ä—è–º—ã–º API –∑–∞–ø—Ä–æ—Å–∞–º –µ—Å–ª–∏ `city_id` –Ω–µ –ø–µ—Ä–µ–¥–∞–Ω
   - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫—ç—à–∞

### Frontend (Next.js/TypeScript)

1. **`lib/api.ts`**
   - –ò–∑–º–µ–Ω–µ–Ω—ã —Å–∏–≥–Ω–∞—Ç—É—Ä—ã –º–µ—Ç–æ–¥–æ–≤: —Ç–µ–ø–µ—Ä—å –ø—Ä–∏–Ω–∏–º–∞—é—Ç `cityId` –≤–º–µ—Å—Ç–æ `lat, lon`
   - `getDashboardAgriculture(cityId)`
   - `getDashboardInsurance(cityId, region?)`
   - `getDashboardWildfires(cityId, radiusKm?)`
   - `getDashboardMain(cityId)`

2. **Hooks (–≤—Å–µ 4 —Ö—É–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω—ã)**
   - `useMainDashboard(cityId)` ‚úÖ
   - `useAgricultureData(cityId)` ‚úÖ
   - `useInsuranceData(cityId, region?)` ‚úÖ
   - `useWildfiresData(cityId, radiusKm?)` ‚úÖ

3. **Pages (–≤—Å–µ 4 —Å—Ç—Ä–∞–Ω–∏—Ü—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã)**
   - `app/page.tsx` - –≥–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ ‚úÖ
   - `app/dashboard/farm/page.tsx` ‚úÖ
   - `app/dashboard/insurance/page.tsx` ‚úÖ
   - `app/dashboard/wildfire/page.tsx` ‚úÖ

## üöÄ –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

### –ó–∞–ø—É—Å–∫ –±—ç–∫–µ–Ω–¥–∞:
```bash
cd back
python app.py
```

–ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ –≤—ã —É–≤–∏–¥–∏—Ç–µ:
```
üöÄ Starting SpaceApp API...
üì¶ Initializing cache for cities...
‚úì Loaded data for –ê–ª–º–∞—Ç—ã
‚úì Loaded data for –ê—Å—Ç–∞–Ω–∞
‚úì Loaded data for –ü–∞–≤–ª–æ–¥–∞—Ä
‚úì Loaded data for –ï–∫–∏–±–∞—Å—Ç—É–∑
‚úì Loaded data for –ê–∫—Ç–∞—É
‚úÖ Cache initialized and background refresh started
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫—ç—à–∞:
```bash
# –°–ø–∏—Å–æ–∫ –≥–æ—Ä–æ–¥–æ–≤
curl http://localhost:8001/cities

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫—ç—à–∞
curl http://localhost:8001/cache/stats

# –¢–µ—Å—Ç API —Å –∫—ç—à–µ–º (–ë–´–°–¢–†–û ‚ö°)
curl "http://localhost:8001/api/v1/dashboard/main?city_id=almaty"

# –¢–µ—Å—Ç API –±–µ–∑ –∫—ç—à–∞ (–ú–ï–î–õ–ï–ù–ù–û üêå)
curl "http://localhost:8001/api/v1/dashboard/main?latitude=43.22&longitude=76.85"
```

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –î–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:
- **–í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞**: 2-5 —Å–µ–∫—É–Ω–¥
- **API –≤—ã–∑–æ–≤–æ–≤ –Ω–∞ –∑–∞–ø—Ä–æ—Å**: 3-5 (NASA POWER, OpenWeather, FIRMS)
- **–ù–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ –≤–Ω–µ—à–Ω–∏–µ API**: –æ—á–µ–Ω—å –≤—ã—Å–æ–∫–∞—è

### –ü–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:
- **–í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞**: **< 50ms** ‚ö° (–¥–∞–Ω–Ω—ã–µ –∏–∑ –∫—ç—à–∞)
- **API –≤—ã–∑–æ–≤–æ–≤ –Ω–∞ –∑–∞–ø—Ä–æ—Å**: **0** (–∫—ç—à)
- **–ù–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ –≤–Ω–µ—à–Ω–∏–µ API**: –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è (–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–∞–∑ –≤ 20 –º–∏–Ω—É—Ç)
- **–≠–∫–æ–Ω–æ–º–∏—è API –≤—ã–∑–æ–≤–æ–≤**: **~99%**

## üéØ –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### –ë—ã–ª–æ (–º–µ–¥–ª–µ–Ω–Ω–æ):
1. –û—Ç–∫—Ä—ã—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É ‚Üí –∂–¥–∞—Ç—å 3-5 —Å–µ–∫—É–Ω–¥
2. –°–º–µ–Ω–∏—Ç—å –≥–æ—Ä–æ–¥ ‚Üí —Å–Ω–æ–≤–∞ –∂–¥–∞—Ç—å 3-5 —Å–µ–∫—É–Ω–¥
3. –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –º–µ–∂–¥—É —Ä–∞–∑–¥–µ–ª–∞–º–∏ ‚Üí –∫–∞–∂–¥—ã–π —Ä–∞–∑ –∂–¥–∞—Ç—å

### –°—Ç–∞–ª–æ (–±—ã—Å—Ç—Ä–æ):
1. –û—Ç–∫—Ä—ã—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É ‚Üí **–º–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞** ‚ö°
2. –°–º–µ–Ω–∏—Ç—å –≥–æ—Ä–æ–¥ ‚Üí **–º–≥–Ω–æ–≤–µ–Ω–Ω–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ** ‚ö°
3. –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –º–µ–∂–¥—É —Ä–∞–∑–¥–µ–ª–∞–º–∏ ‚Üí **–º–≥–Ω–æ–≤–µ–Ω–Ω—ã–π –æ—Ç–∫–ª–∏–∫** ‚ö°

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ö—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –≥–æ—Ä–æ–¥–∞:
```json
{
  "city_id": "almaty",
  "city_name": "–ê–ª–º–∞—Ç—ã",
  "latitude": 43.2220,
  "longitude": 76.8512,
  "climate": { /* NASA POWER data */ },
  "weather": { /* OpenWeatherMap data */ },
  "air_quality": { /* AQI data */ },
  "fires": { /* FIRMS fire data */ },
  "cached_at": "2025-10-05T12:00:00",
  "expires_at": "2025-10-05T12:20:00"
}
```

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫—ç—à–∞:
- **–ò–Ω—Ç–µ—Ä–≤–∞–ª**: 20 –º–∏–Ω—É—Ç
- **–ü—Ä–æ—Ü–µ—Å—Å**: –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –¥–ª—è –≤—Å–µ—Ö –≥–æ—Ä–æ–¥–æ–≤
- **–§–æ–Ω–æ–≤—ã–π —Ä–µ–∂–∏–º**: –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ø—Ä–æ–≥—Ä–µ—Å—Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤–∏–¥–µ–Ω –≤ –ª–æ–≥–∞—Ö

### Fallback –º–µ—Ö–∞–Ω–∏–∑–º:
–ï—Å–ª–∏ –ø–µ—Ä–µ–¥–∞—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤–º–µ—Å—Ç–æ `city_id`, API –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–¥–µ–ª–∞–µ—Ç –ø—Ä—è–º—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ –≤–Ω–µ—à–Ω–∏–º —Å–µ—Ä–≤–∏—Å–∞–º (–º–µ–¥–ª–µ–Ω–Ω–æ, –Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –ª—é–±–æ–π —Ç–æ—á–∫–∏ –Ω–∞ –∫–∞—Ä—Ç–µ).

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–æ—á–Ω—ã–π —Å–ø–∏—Å–æ–∫

- [x] Backend –∫—ç—à-–º–µ–Ω–µ–¥–∂–µ—Ä —Å–æ–∑–¥–∞–Ω
- [x] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
- [x] –§–æ–Ω–æ–≤–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 20 –º–∏–Ω—É—Ç
- [x] –í—Å–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç city_id
- [x] Frontend API –∫–ª–∏–µ–Ω—Ç –æ–±–Ω–æ–≤–ª—ë–Ω
- [x] –í—Å–µ —Ö—É–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã
- [x] –í—Å–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã
- [x] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ
- [x] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞

## üéâ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!

–¢–µ–ø–µ—Ä—å —Å–∞–π—Ç –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è **–º–≥–Ω–æ–≤–µ–Ω–Ω–æ**, –∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É –≥–æ—Ä–æ–¥–∞–º–∏ –±—É–¥–µ—Ç –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç—å **–±–µ–∑ –∑–∞–¥–µ—Ä–∂–µ–∫**!

### –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:
1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±—ç–∫–µ–Ω–¥: `cd back && python app.py`
2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥: `cd front && npm run dev`
3. –û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:3000
4. –ù–∞—Å–ª–∞–∂–¥–∞–π—Ç–µ—Å—å –º–æ–ª–Ω–∏–µ–Ω–æ—Å–Ω–æ–π —Å–∫–æ—Ä–æ—Å—Ç—å—é! ‚ö°
