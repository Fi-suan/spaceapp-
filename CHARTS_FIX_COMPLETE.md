# ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–æ–≤ - –ó–∞–≤–µ—Ä—à–µ–Ω–æ

## –ü—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### ‚ùå –ü—Ä–æ–±–ª–µ–º–∞ 1: –ì—Ä–∞—Ñ–∏–∫ –≤ Insurance –Ω–µ –º–µ–Ω—è–ª—Å—è –ø—Ä–∏ —Å–º–µ–Ω–µ –≥–æ—Ä–æ–¥–∞
**–ü—Ä–∏—á–∏–Ω–∞**: –ì—Ä–∞—Ñ–∏–∫ –ø–æ–∫–∞–∑—ã–≤–∞–ª –¥–∞–Ω–Ω—ã–µ –ø–æ –º–µ—Å—è—Ü–∞–º, –Ω–æ –∑–∞ 7-14 –¥–Ω–µ–π –¥–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω –º–µ—Å—è—Ü

**–†–µ—à–µ–Ω–∏–µ**:
- –ò–∑–º–µ–Ω–∏–ª–∏ –ª–æ–≥–∏–∫—É —Å –º–µ—Å—è—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –Ω–∞ **–ø–æ–¥–Ω–µ–≤–Ω—ã–µ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω—é—é –Ω–µ–¥–µ–ª—é**
- –ì—Ä–∞—Ñ–∏–∫ —Ç–µ–ø–µ—Ä—å –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç 7 —Ç–æ—á–µ–∫ –¥–∞–Ω–Ω—ã—Ö (–ø–æ –æ–¥–Ω–æ–π –Ω–∞ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å)
- –ö–∞–∂–¥–∞—è —Ç–æ—á–∫–∞ –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–æ–≥–æ–¥–Ω—ã—Ö —É—Å–ª–æ–≤–∏–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –¥–Ω—è

**–ö–æ–¥ (backend)**:
```python
# –ë–µ—Ä–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π
for date_str in dates[-7:]:
    date_obj = datetime.strptime(date_str, "%Y%m%d")
    day_label = date_obj.strftime("%d %b")  # "05 Oct"

    temp = t2m_data.get(date_str, 0)
    rain = prec_data.get(date_str, 0)

    # –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Ä–∏—Å–∫ –¥–ª—è –¥–Ω—è
    day_risk = 50  # –±–∞–∑–æ–≤—ã–π
    if temp < 0 or temp > 30:
        day_risk += 20
    if rain > 10:
        day_risk += 15
    elif rain < 1:
        day_risk += 10  # –∑–∞—Å—É—Ö–∞

    risk_trends.append({
        "month": day_label,  # –ò—Å–ø–æ–ª—å–∑—É–µ–º –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
        "riskScore": round(day_risk, 1)
    })
```

**–û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è –ø–æ–¥–ø–∏—Å—å –≥—Ä–∞—Ñ–∏–∫–∞**:
- –ë—ã–ª–æ: "Regional Risk Trends - Monthly risk scores"
- –°—Ç–∞–ª–æ: "Risk Trends (7 days) - Daily risk scores based on weather conditions"

---

### ‚ùå –ü—Ä–æ–±–ª–µ–º–∞ 2: –í Agriculture —Ç–æ–ª—å–∫–æ 3 —Ç–æ—á–∫–∏ –≤–º–µ—Å—Ç–æ 7
**–ü—Ä–∏—á–∏–Ω–∞**: NASA POWER API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π 1-2 –¥–Ω—è

**–†–µ—à–µ–Ω–∏–µ**:
- –£–≤–µ–ª–∏—á–∏–ª–∏ –ø–µ—Ä–∏–æ–¥ –∑–∞–ø—Ä–æ—Å–∞ —Å 7 –¥–æ **14 –¥–Ω–µ–π**
- –ë–µ—Ä–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –≤–∞–ª–∏–¥–Ω—ã—Ö —Ç–æ—á–µ–∫ –∏–∑ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –ò—Å–ø–æ–ª—å–∑—É–µ–º –≤—á–µ—Ä–∞—à–Ω–∏–π –¥–µ–Ω—å –∫–∞–∫ –∫–æ–Ω–µ—á–Ω—É—é –¥–∞—Ç—É (–≤–º–µ—Å—Ç–æ —Å–µ–≥–æ–¥–Ω—è)

**–ö–æ–¥ (backend)**:
```python
# –ë—ã–ª–æ:
start_date = (datetime.now() - timedelta(days=7)).strftime("%Y%m%d")
end_date = datetime.now().strftime("%Y%m%d")

# –°—Ç–∞–ª–æ:
start_date = (datetime.now() - timedelta(days=14)).strftime("%Y%m%d")
end_date = (datetime.now() - timedelta(days=1)).strftime("%Y%m%d")  # –í—á–µ—Ä–∞
```

---

### ‚úÖ –ë–æ–Ω—É—Å: –î–æ–±–∞–≤–ª–µ–Ω –≥—Ä–∞—Ñ–∏–∫ –Ω–∞ Main Dashboard
**–ß—Ç–æ –¥–æ–±–∞–≤–∏–ª–∏**: –ì—Ä–∞—Ñ–∏–∫ "7-Day Risk Forecast" –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ

**–î–∞–Ω–Ω—ã–µ**: –û–±—â–∏–π —Ä–∏—Å–∫ –ø–æ –¥–Ω—è–º (–∫–æ–º–±–∏–Ω–∞—Ü–∏—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã, –æ—Å–∞–¥–∫–æ–≤ –∏ –¥—Ä—É–≥–∏—Ö —Ñ–∞–∫—Ç–æ—Ä–æ–≤)

**–ö–æ–¥ (backend)**:
```python
for date_str in dates[-7:]:
    temp_day = climate_params.get("T2M", {}).get(date_str, 0)
    rain = climate_params.get("PRECTOTCORR", {}).get(date_str, 0)

    # –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –æ–±—â–∏–π —Ä–∏—Å–∫ –¥–ª—è –¥–Ω—è
    day_risk = 50  # –±–∞–∑–æ–≤—ã–π
    if temp_day < 0 or temp_day > 30:
        day_risk += 20
    if rain > 10:
        day_risk += 15
    elif rain < 1:
        day_risk += 10

    risk_forecast.append({
        "date": day_name,  # Mon, Tue, etc.
        "risk": round(day_risk, 1)
    })
```

---

## üìä –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

### 1. Agriculture
```json
GET /api/v1/dashboard/agriculture?city_id=almaty

{
  "forecast_7day": [
    {"date": "Mon", "tempMin": 12.5, "tempMax": 24.3, "precipitation": 0.2},
    {"date": "Tue", "tempMin": 13.1, "tempMax": 25.1, "precipitation": 0.0},
    ...
  ]
}
```
‚úÖ –¢–µ–ø–µ—Ä—å –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 7 —Ç–æ—á–µ–∫ –¥–∞–Ω–Ω—ã—Ö

---

### 2. Insurance
```json
GET /api/v1/dashboard/insurance?city_id=almaty

{
  "risk_trends": [
    {"month": "05 Oct", "riskScore": 65.5},
    {"month": "06 Oct", "riskScore": 68.2},
    {"month": "07 Oct", "riskScore": 62.1},
    ...
  ]
}
```
‚úÖ –î–∞–Ω–Ω—ã–µ –º–µ–Ω—è—é—Ç—Å—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –≥–æ—Ä–æ–¥–∞
‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–æ–¥–Ω–µ–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤–º–µ—Å—Ç–æ –º–µ—Å—è—á–Ω—ã—Ö

---

### 3. Main Dashboard
```json
GET /api/v1/dashboard/main?city_id=almaty

{
  "risk_forecast_7day": [
    {"date": "Mon", "risk": 67.5},
    {"date": "Tue", "risk": 65.2},
    ...
  ]
}
```
‚úÖ –ù–æ–≤–æ–µ –ø–æ–ª–µ –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞ —Ä–∏—Å–∫–æ–≤

---

## üé® Frontend –∏–∑–º–µ–Ω–µ–Ω–∏—è

### TypeScript —Ç–∏–ø—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã:

```typescript
// DashboardInsuranceResponse
risk_trends: Array<{
  month: string        // –¢–µ–ø–µ—Ä—å "05 Oct" –≤–º–µ—Å—Ç–æ "Jan"
  riskScore: number
}>

// DashboardMainResponse
risk_forecast_7day: Array<{
  date: string         // "Mon", "Tue", etc.
  risk: number
}>
```

### –°—Ç—Ä–∞–Ω–∏—Ü—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã:

**Insurance** (`/dashboard/insurance`):
```typescript
const riskData = data?.risk_trends?.length > 0
  ? data.risk_trends      // ‚úÖ –†–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ API
  : [...mockData...]      // Fallback
```

**Main Dashboard** (`/`):
```typescript
const forecastData = dashboardData?.risk_forecast_7day?.length > 0
  ? dashboardData.risk_forecast_7day  // ‚úÖ –†–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
  : [...mockData...]                   // Fallback
```

---

## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
- ‚ùå Agriculture: 3 —Ç–æ—á–∫–∏ –≤–º–µ—Å—Ç–æ 7
- ‚ùå Insurance: –≥—Ä–∞—Ñ–∏–∫ –Ω–µ –º–µ–Ω—è–ª—Å—è –ø—Ä–∏ —Å–º–µ–Ω–µ –≥–æ—Ä–æ–¥–∞ (–º–µ—Å—è—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)
- ‚ùå Main Dashboard: —Å—Ç–∞—Ç–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
- ‚úÖ Agriculture: **7 —Ç–æ—á–µ–∫ –¥–∞–Ω–Ω—ã—Ö** (—Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ min/max –∑–∞ –Ω–µ–¥–µ–ª—é)
- ‚úÖ Insurance: **7 —Ç–æ—á–µ–∫ –ø–æ–¥–Ω–µ–≤–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö**, –º–µ–Ω—è–µ—Ç—Å—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –≥–æ—Ä–æ–¥–∞
- ‚úÖ Main Dashboard: **7 —Ç–æ—á–µ–∫ —Å –ø—Ä–æ–≥–Ω–æ–∑–æ–º —Ä–∏—Å–∫–æ–≤**, —É–Ω–∏–∫–∞–ª—å–Ω–æ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –≥–æ—Ä–æ–¥–∞
- ‚úÖ –í—Å–µ –≥—Ä–∞—Ñ–∏–∫–∏ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –ø—Ä–∏ —Å–º–µ–Ω–µ –≥–æ—Ä–æ–¥–∞
- ‚úÖ Fallback –∫ mock –¥–∞–Ω–Ω—ã–º –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ API –¥–∞–Ω–Ω—ã—Ö

---

## üîÑ –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–µ–π—á–∞—Å

1. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç –≥–æ—Ä–æ–¥** ‚Üí —Ç—Ä–∏–≥–≥–µ—Ä–∏—Ç—Å—è –∑–∞–ø—Ä–æ—Å –∫ API
2. **API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ** –∏–∑ –∫—ç—à–∞ (–æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 20 –º–∏–Ω—É—Ç)
3. **–î–∞–Ω–Ω—ã–µ —Å–æ–¥–µ—Ä–∂–∞—Ç**:
   - –ü–æ—Å–ª–µ–¥–Ω–∏–µ 7-14 –¥–Ω–µ–π NASA POWER (—Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞, –æ—Å–∞–¥–∫–∏)
   - –¢–µ–∫—É—â–∏–µ –ø–æ–≥–æ–¥–Ω—ã–µ —É—Å–ª–æ–≤–∏—è OpenWeatherMap
   - –†–∞—Å—á–µ—Ç–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã —Ä–∏—Å–∫–∞
4. **–ì—Ä–∞—Ñ–∏–∫–∏ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è** —Å –Ω–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –≥–æ—Ä–æ–¥–∞

---

## üöÄ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±—ç–∫–µ–Ω–¥:
   ```bash
   cd back && python app.py
   ```

2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥:
   ```bash
   cd front && npm run dev
   ```

3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≥—Ä–∞—Ñ–∏–∫–∏:
   - **Agriculture** (`/dashboard/farm`): 7 —Ç–æ—á–µ–∫ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã
   - **Insurance** (`/dashboard/insurance`): 7 —Ç–æ—á–µ–∫ —Ä–∏—Å–∫–∞ –ø–æ –¥–Ω—è–º
   - **Main** (`/`): 7 —Ç–æ—á–µ–∫ –æ–±—â–µ–≥–æ —Ä–∏—Å–∫–∞

4. **–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç–µ –≥–æ—Ä–æ–¥** –≤ —Å–∞–π–¥–±–∞—Ä–µ:
   - –í—Å–µ –≥—Ä–∞—Ñ–∏–∫–∏ –¥–æ–ª–∂–Ω—ã –æ–±–Ω–æ–≤–∏—Ç—å—Å—è —Å –Ω–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
   - –ö–∞–∂–¥—ã–π –≥–æ—Ä–æ–¥ –∏–º–µ–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è

---

## üìù –†–µ–∑—é–º–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π

### Backend:
- ‚úÖ `external_apis.py`: –£–≤–µ–ª–∏—á–µ–Ω –ø–µ—Ä–∏–æ–¥ –∑–∞–ø—Ä–æ—Å–∞ NASA POWER –¥–æ 14 –¥–Ω–µ–π
- ‚úÖ `dashboard_sections.py`:
  - Agriculture: –¥–æ–±–∞–≤–ª–µ–Ω–æ `forecast_7day` (7 —Ç–æ—á–µ–∫ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã)
  - Insurance: –∏–∑–º–µ–Ω–µ–Ω–æ `risk_trends` –Ω–∞ –ø–æ–¥–Ω–µ–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
  - Main: –¥–æ–±–∞–≤–ª–µ–Ω–æ `risk_forecast_7day` (7 —Ç–æ—á–µ–∫ –æ–±—â–µ–≥–æ —Ä–∏—Å–∫–∞)

### Frontend:
- ‚úÖ `types.ts`: –û–±–Ω–æ–≤–ª–µ–Ω—ã —Ç–∏–ø—ã –¥–ª—è –≤—Å–µ—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤
- ‚úÖ `insurance/page.tsx`: –ì—Ä–∞—Ñ–∏–∫ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–µ `risk_trends`
- ‚úÖ `page.tsx` (main): –ì—Ä–∞—Ñ–∏–∫ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–µ `risk_forecast_7day`

üéâ –í—Å–µ –≥—Ä–∞—Ñ–∏–∫–∏ —Ç–µ–ø–µ—Ä—å –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç **—Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ** –∏ **–æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –ø—Ä–∏ —Å–º–µ–Ω–µ –≥–æ—Ä–æ–¥–∞**!
